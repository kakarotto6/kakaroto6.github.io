--- 
layout: post
title: TCP/IP_1
date: 2018-9-22
tags: tcp/ip
---

![enter description here](https://viabcde.github.io/images/2018-09-22/tcpip.png)  
![enter description here](https://viabcde.github.io/images/2018-09-22/2018092201.png)  
在上图中，也有一些应用程序直接访问ip层（一些较老的选路协议就是以这种方式来实现的。当然新的运输层协议也有可能使用这种方式）  
### **ICMP**
是IP协议的附属协议。IP层用它来与其他主机或路由器交换错误报文和其他重要信息.  不仅仅是IP使用了ICMP 流行的诊断工具如Ping和Traceroute，它们也使用了ICMP。  
### **IGMP**
是Internet组管理协议。它用来把一个UDP数据报多播到多个主机。
ARP（地址解析协议）和RARP逆地址解析协议）是某些网络接口（如以太网和令牌环
网）使用的特殊协议，用来转换IP层和网络接口层使用的地址。  
### **1.TCP/IP**
是最常应用的组网（组建网络）形式，是全球互联网和因特网的基础  
### **2.链路层**
设备驱动程序+网卡（网络接口卡）----组合处理连接如电缆等物理接口细节   
### **3.网络层**
处理分组在网络中路径的选择等。网络层协议包括IP协议（网际协议），ICMP协议（Internet互联网控制报文协议），以及IGMP协议（Internet组管理协议）。  
### **4.运输层**
运输层主要为两台主机上的应用程序提供端到端的通信。在TCP/IP协议族中，有两个互不相同的传输协议：TCP（传输控制协议）和UDP（用户数据报协议）。  
### **TCP报文段**
为两台主机提供高可靠性的数据通信。它必须确认接收到的分组，且设置了发送最后确认分组的超时时钟等。由于运输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。  
### **UDP数据报**
则为应用层提供一种非常简单的服务。它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。任何必需的可靠性必须由应用层来提供。  
### **IP数据报**
### **5.应用层**
应用层负责处理特定的应用程序细节。几乎各种不同的TCP/IP实现程序都会提供下面这些通用的应用程序的实现方法：  
**• Telnet** 远程登录。  
**• FTP** 文件传输协议。  
**• SMTP** 简单邮件传送协议。  
**• SNMP** 简单网络管理协议。  
FTP是一种应用层协议  
TCP是一种运输层协议  
IP是一种网络层协议  
以太网协议则应用于链路层上    
### **路由器:** 
构造互连网最简单的方法是把两个或多个网络通过路由器进行连接。它是一种特殊的用于网络互连的硬件盒。这些盒子称作网关（gateway）  
### **路由器的好处:** 
是为不同类型的物理网络提供连接：以太网、令牌环网、点对点的链接和FDDI（光纤分布式数据接口）等等。  
IP提供的只是尽可能快地把分组从源结点送到目的结点  
TCP采用了超时重传、发送和接收端到端的确认分组等机制，为ip增加了可靠性  
![enter description here](https://viabcde.github.io/images/2018-09-22/2018092202.png)    
![enter description here](https://viabcde.github.io/images/2018-09-22/2018092203.png)    
区分各类地址的最简单方法是看它的第一个十进制整数。  
Internet注册服务(IP地址和DNS域名)过去由NIC来负责，其网络地址是nic.ddn.mil。
1993年4月1日，InterNIC成立。现在，NIC只负责处理国防数据网的注册请求，所有其他的Internet用户注册请求均由InterNIC负责处理，其网址是：rs.internic.net。
事实上InterNIC由三部分组成：注册服务（rs.internic.net），目录和数据库服务（ds.internic.net），以及信息服务（is.internic.net）。  
域名系统（DNS）是一个分布的数据库，由它来提供IP地址和主机名之间的映射信息
帧：链路层在以太网传输的比特流  
### **IP首部空出8位的长度的原因**
由于TCP、UDP、ICMP和IGMP都要向IP传送数据，因此IP必须在生成的IP首部中加入某种标识，以表明数据属于哪一层。为此，IP在首部中存入一个长度为8bit的数值，称作协议域。 1表示为ICMP协议，2表示为IGMP协议，6表示为TCP协议，17表示为UDP协议。  
类似地，许多应用程序都可以使用 TCP或UDP来传送数据。运输层协议在生成报文首部
时要存入一个应用程序的标识符。TCP和UDP都用一个16bit的端口号来表示不同的应用程序。  
TCP和UDP把源端口号和目的端口号分别存入报文首部中。  
网络接口分别要发送和接收IP、ARP和RARP数据，因此也必须在以太网的帧首部中加入
某种形式的标识，以指明生成数据的网络层协议。为此，以太网的帧首部也有一个16bit的帧类型域。  
服务器一般都是通过知名端口号来识别的。例如，对于每个TCP/IP实现来说，FTP服务器的TCP端口号都是21，每个Telnet服务器的TCP端口号都是23，每个TFTP(简单文件传送协议)服务器的UDP端口号都是69。任何TCP/IP实现所提供的服务都用知名的1～1023之间的端口号。  

知名端口号介于1～255之间。256～1023之间的端口号通常都是由Unix系统占用，以提供一些特定的Unix服务—也就是说，提供一些只有Unix系统才有的、而其他操作系统可能不提供的服务。现在IANA管理1～1023之间所有的端口号。  

客户端口号又称作临时端口号（即存在时间很短暂）。这是因为它通常只是在用户运行该客户程序时才存在，而服务器则只要主机开着的，其服务就运行。  
![enter description here](https://viabcde.github.io/images/2018-09-22/2018092204.png)    
intenet 动词 使主机连在一起 Intenet 名词 是所有主机的集合  
### **分用和复用**
分用：将以太网的帧一层层分离直至交给对应的app
复用：将app的数据一层层复合上标志上传到以太网中
### **子网掩码的作用**
为了计算两个IP地址是否属于同一个网络中  
因为1与1得1 1与0的0  
IP与运算子网掩码255.255.255.0可以得到网络号  
例如：  
202.99.160.50 换算成二进制为 11001010·01100011·10100000·00110010   
255.255.255.0 换算成二进制为 11111111·11111111·11111111·00000000   
将二者进行与运算   
### **网关**
每个网络之间连接的桥梁  
因为每个网络中的主机只能与该网络的其他主机通信，不能和其他网络的主机通信  
只有通过网关即路由器作为代理，其他网关作为另一个主机的代理，这两个主机才能通信  
### **http持久连接**
http在的一次会话需要先建立tcp连接（大部分是tcp，但是其他安全协议也是可以的），然后才能通信，如果每次连接都只进行一次http会话，那这个连接过程占的比例太大了！

　　于是出现了持久连接：在http/1.0+中是connection首部中添加keep-alive值，在http/1.1中是在connection首部中添加persistent值，当然两者不仅仅是命名上的差别，http/1.1中，持久连接是默认的，除非显示在connection中添加close，否则持久连接不会关闭，而http/1.0+中则恰好相反，除非显示在connection首部中添加keep-alive，否则在接收数据包后连接就断开了。

　　出现了持久连接还不够，在http/1.1中，还有一种称为管道通信的方式进行速度优化：把需要发送到服务器上的所有请求放到输出队列中，在第一个请求发送出去后，不等到收到服务器的应答，第二个请求紧接着就发送出去，但是这样的方式有一个问题：不安全

``` 
public class Main_1 {
    public static void main(String[] args) {
        Integer a = 1;
        Integer b = 2;
        Integer c = 3;
        Integer d = 3;
        Integer e = 321;
        Integer f = 321;
        Long g = 3L;
        System.out.println(c == d);
        System.out.println(e == f);
        System.out.println(c == (a + b));//true
        System.out.println(c.equals(a + b));
        System.out.println(g == (a + b));//true
        System.out.println(g.equals(a + b));
        System.out.println(g.equals(a + h));
    }

}
```
### **网络传输**
在控制台输入 hello   
经过应用层 ap hello  
经过传输层 tcp ap hello  
经过网络层 ip tcp ap hello  
经过链路层 帧头 帧尾 ip tcp ap hello  
经过路由器转发  
经过链路层  ip tcp ap hello  
经过网络层  tcp ap hello  
经过传输层  ap hello  
经过应用层  hello  
在控制台输出 hello  
### **各类ip地址**
a类 0+7位网络号 +3个字节主机号  
b类 10+14位网络号+2个字节主机号  
c类 110+21位网络号+1个字节主机号  
### **路由器寻址**
每个路由器都会管理一些ip地址 构成自己的子网  
当某一台主机发出寻址要求时   路由器先查看自己的子网是否有对应的ip没有则转发给其他路由器 一直转发至找到ip
### **单工 、半双工、全双工**
单工 只能发送不能回复 bb机  
半双工 一方说话时另一方不能说 对讲机  
全双工 双方可以同时说话



  
  
