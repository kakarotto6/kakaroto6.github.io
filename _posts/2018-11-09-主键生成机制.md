--- 
layout: post
title: 主键生成机制
date: 2018-11-18
tags: Hibernate
---
## **Hibernate 的的不同属性含义**
### **assigned**
主键由外部程序生成。
### **hilo**
通过hi/lo 算法生成主键，需要额外的数据库表保存主键生成历史状态。
### **seqhilo**
与hilo 类似，通过hi/lo 算法生成主键，只是主键历史状态保存在Sequence中，适用于支持Sequence的数据库，如Oracle。
### **increment**
主键按数值顺序递增     
这种方式可能产生的问题是：如果有多个实例访问同一个数据库，那么由于各个实例各自维护主键状态，造成主键重复异常。
### **identity**
数据库提供的主键生成机制。如DB2、SQL Server、MySQL 
### **sequence**
采用数据库提供的sequence 机制生成主键。如Oralce的Sequence。  
### **native**
由Hibernate根据底层数据库自行采用identity、hilo、sequence其中一种主键生成方式。
### **uuid.hex**
由Hibernate基于128 位唯一值产生算法生成16 进制数值（编码后以长度32 的字符串表示）作为主键。  
### **uuid.string**
与uuid.hex 类似，只是生成的主键未进行编码（长度16）。在某些数据库中可能出现问题（如PostgreSQL）。
### **foreign**
使用外部表的字段作为主键。 
**PS**

``` 
一般而言，利用uuid.hex方式生成主键将提供最好的性能和数据库平台适 应性。   
另外由于常用的数据库，如Oracle、DB2、SQLServer、MySql 等，都提 
供了易用的主键生成机制（Auto-Increase 字段或者Sequence）。我们可以在数 
据库提供的主键生成机制上，采用generator-class=native的主键生成方式。      
数据库提供的主键生成机制，往往是通过在一个内部表中保存当前主键状 
态（如对于自增型主键而言，此内部表中就维护着当前的最大值和递增量）， 
之后每次插入数据会读取这个最大值，然后加上递增量作为新记录的主键，之 
后再把这个新的最大值更新回内部表中，这样，一次Insert操作可能导致数据 
库内部多次表读写操作和数据的加锁解锁操作.
```

