--- 
layout: post
title: Config配置
date: 2018-11-19
tags: Mybatis
---
## **Config配置**
##  properties 
作用：配置属性
 **配置方式：**  
（1）property子元素，配置代码示例如下          
``` 
<properties>
	<properties name="driver" value="com.mysql.jdbc.Driver"/>
	<properties name="url" value="jdbc:mysql://localhost:3306/mybatis"/>
	<properties name="username" value="root"/>
	<properties name="password" value="****"/>
</properties>
```
 配置参数在配置文件中怎么使用？                    

``` 
<dataSource type="POOLED">
	<properties name="driver" value="${driver}"/>
	<properties name="url" value="{url}"/>
	<properties name="username" value="${username}"/>
	<properties name="password" value="${password}"/>
</dataSource>
```

（2）properties配置文件：方便在多个配置文件中重复使用，便于修改和维护。
 properties文件代码示例：            
**数据库配置文件**
``` 
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis
username=root
password=****
```
如何使用？将该文件放到源包下，引入即可：<properties resource="jdbc.properties"/>   
### **3 程序参数传递：**
有的时候为了数据的安全，在jdbc.properties配置密文，通过程序明文解密，保证系统的安全。

### **4 三种配置方式的优先级：**
第三种通过程序方法参数传递的属性具有最高优先级，resource/url属性中指定的配置文件次之，最低优先级是properties元素中指定的属性。            
## settings

settings是mybatis最复杂的配置，也是最重要的配置，配置内容繁多，这里不予总结，配置内容项自行了解，那么如何配置哪？ 完整的配置示例如下        
 ![enter description
here](https://viabcde.github.io/images/2018-10-10/2018101031.png) 

``` 
<settings>
	<settings name="cacheEnable" value="true"/>
	<settings name="lazyLoadingEnabled" value="true"/>
	<settings name="multipleResultSetsEnabled" value="true"/>
	<settings name="useColumnLabel" value="true"/>
	<settings name="useGeneratedKeys" value="false"/>
	<settings name="autoMappingBehavior" value="PARTIAL"/>
	<settings name="defaultExecutorType" value="SIMPLE"/>
	<settings name="defaultStatementTimeout" value="25"/>
	<settings name="safeRowBoundsEnabled" value="false"/>
	<settings name="mapUnderscoreToCamelCase" value="false"/>
	<settings name="localCacheScope" value="SESSION"/>
	<settings name="jdbcTypeForNull" value="OTHER"/>
	<settings name="lazyLoadTriggerMethods" value="equals,clone,hashCode,toString"/>
</settings>
```

## typeAliases

### **1 作用：**
别名可以代替过长类全限定名，在mybatis上下文中使用。

###  **2 分类**
（1）系统自定义别名：如下表
![enter description
here](https://viabcde.github.io/images/2018-10-10/2018101030.png) 
                
（2）自定义别名：示例代码如下，使用role代替其类的全路径，减少配置的复杂度              

``` 
<!--定义别名--!>
<typeAliases>
	<typeAlias alias="role" type="com.liming.domain.po.Role"/>
</typeAlias>
```
## **typeHandler**
 ### **1  作用：**
 预处理语句（PreparedStatemen）中设置参数或者从结果集（ResultSet）中取值，都需要注册了的typeHandler进行类型转换。

### **2 分类：**
（1）系统定义

 1）系统注册的TypeHandler
 2）代码示例                                       

``` 
public TypeHandlerRegistry(){
	register(Boolean.class, new BooleanTypeHandler());
	register(boolean.class, new BooleanTypeHandler());
	register(JdbcType.BOOLEAN, new BooleanTypeHandler());
	register(JdbcType.BIT, new BooleanTypeHandler());
	......
	register(Character.class, new CharacterTypeHandler());
	register(char.class, new CharacterTypeHandler());
}
```
 3）常用配置：java类型（javaType）、JDBC类型（jdbcType）。TypeHandler将参数从javaType转换为jdbcType，或者从数据库取出结果时把jdbcType转换为javaType。

（2）自定义

 1）注册自定义typeHandler，重新覆盖字符串参数的typeHandler                                

``` 
<typeHandlers>
	<typeHandler jdbc="VARCHAR" javaType="string" 
handler="com.liming.domain.typeHandler.myStringTypeHandler"/>
</typeHandlers>
```

 2）通过扫描注册typeHandle

``` 
<typeHandlers>
	<package name="com.liming.domain.typeHandler"/>
</typeHandlers>                                     
```

（3）枚举：mybatis提供了俩个转化枚举类型的typeHandle：org.apache.ibatis.type.EnumTypeHandler和org.apache.ibatis.type.EnumOrdinalTypeHandler。

## **ObjectFactory**
### **1 作用：**
mybatis构建结果返回的时候，会使用ObjectFactory（对象工厂）构建POJO。

### **2 分类 ：**
（1）默认的，mybatis中默认的ObjectFactory是由org.apache.ibatis.reflection.factory.DefaultObjectFactory来提供服务的。
（2）自定义 ，定义新的ObjectFactory代码示例如下，实现代码的时候，我们新的ObjectFactory类直接继承DefaultObjectFactory来实现ObjectFactory的接口。
``` 
<objectFactory type="com.liming.domain.objectFactory.MyObjectFactory">
	<property name="name" value="MyObjectFactory"/>
</objectFactory>
```

## plugins

##  environments

### **1 作用：**
主要是用来配置连接池的数据源。

### **2 数据源俩大部分：**

（1）数据库源的配置，通过dataSource标签来配置数据源连接信息，通过子标签property来定义数据库的各类参数，type属性代表数据库连接方式的配置，提供如下四种：
 1）UNPOOLED，非连接池数据库（UnpooledDataSource）；
 2）POOLED，连接池数据库（PooledDataSource）；
 3）JNDI，JNDI数据源（JNDIDataSource）；
 4）自定义数据源，必须实现org.apache.ibatis.datasource.DataSourceFactory接口
（2）数据库事务的配置，通过transactionManager标签来配置，通过子标签property来配置数据源的各类属性，type属性包含如下三种配置方式
 1）JDBC，采用JDBC方式管理事务，在独立编码中常用；
  2）MANAGED，采用容器方式管理事务，在JNDI数据源中常用；
 3）自定义，由开发者自定义数据库事务管理方法，适用于特殊应用；
（3）一个数据源完整配置的代码示例
``` 
<environments default="development">
	<environment id="development">
		<transactionManager type="JDBC">
			<property name="autoCommit" value="false">
		</transactionManager>
		<dataSource type="POOLED">
			<property name="driver" value="com.mysql.jdbc.Driver"/>
			<property name="url" value="jdbc:mysql://localhost:3306/mybatis"/>
			<property name="username" value="root"/>
			<property name="password" value="****"/>
		</dataSource>
	</environment>
</environments>
```
备注：environment中的属性default，表明缺省情况下，我们启动哪个数据源配置。
## databaseIdProvider：
它的作用在于指定SQL到对应的数据库厂商提供的数据库中运行，一般应用较少，使用不同厂商数据库的情况较少。mybatis也为数据库厂商标识提供系统默认规则和自定义规则俩种方式，有兴趣自行了解即可。

