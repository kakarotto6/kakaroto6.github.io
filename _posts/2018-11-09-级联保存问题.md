--- 
layout: post
title: 增删改
date: 2018-11-18
tags: Hibernate
---
## **级联问题**
保存transient对象出问题
如下图g 没有被save  many2one   one2many  user保存 group不会跟着自动保存
![enter description
here](https://viabcde.github.io/images/blog/2018092883.png)  
### **解决方法1：把上图注释打开，先存g 再存 a**
### **在group.java 保存group时自动保存其关联对象**
设置group能级联保存
![enter description
here](https://viabcde.github.io/images/blog/2018092884.png)  
![enter description
here](https://viabcde.github.io/images/blog/2018092885.png)  
同理，可以在user.java即多的这一方设置 保存user时自动保存其关联对象g，如
**解决方法：**  
![enter description
here](https://viabcde.github.io/images/blog/2018092886.png)  
**问题：在数据库里u没有g的数据**   
![enter description
here](https://viabcde.github.io/images/blog/2018092887.png)  
**解决方法：user设置group属性**   
![enter description
here](https://viabcde.github.io/images/blog/2018092888.png)  
结论：存储时在save多的一方较容易只需要设多的一方即可 如果save一的一方则后需要 把多地一方再设一遍
many-to-one默认取多的一方user会把一的一方group取出来，即使不设置cascade为ALL而取一的一方group不会把多的一方user取出来
**测试：**
![enter description
here](https://viabcde.github.io/images/blog/2018092889.png)  
![enter description
here](https://viabcde.github.io/images/blog/2018092890.png)  
结论：cascade管增删改 而fetch管读取
![enter description
here](https://viabcde.github.io/images/blog/2018092891.png)  
group的fetch是eager user是lazy 则在用user .getGroup时会发2条sql，一次是取user和group联合的,另一次因为group是eager的所以在第一次取group时，会顺带着把user再取一遍
在xml中懒加载设置
![enter description
here](https://viabcde.github.io/images/blog/2018092892.png)  
一对多设置eager情况：查看用户的权限；
### **update**
(一般cascade设为all，否则可能更新其他的方法不成功，比如设为merge,就只有用merge方法时能更新)
![enter description
here](https://viabcde.github.io/images/blog/2018092893.png)  
### **delete**
在删除前如果不先删除其级联对象会把一个一方group也给删了，如果此时有其他对象级联了group，那么该对象也被清除，才能清除group
解决方法1：打破级联关系 先把级联对象设为空
解决方法二：使用sql语句
![enter description
here](https://viabcde.github.io/images/blog/2018092894.png)  
### **deletegroup**
![enter description
here](https://viabcde.github.io/images/blog/2018092895.png)  
### **list和iterate区别**
list取的是id+所有信息 iterate取的是id 当用到的时候再根据id取相应的值
list每执行一次都会发出sql语句，而iterate会利用session级的缓存，只会发出一次sql语句
