--- 
layout: post
title: 获取插入的数据的主键
date: 2018-11-18
tags: Mybatis
---
###  **一般插入数据后想知道插入的数据的主键是多少，我们可以通过以下的方式来获取**
需求：
user对象插入到数据库后，新记录的主键要通过user对象返回，通过user获取主键值。
解决思路：
通过LAST_INSERT_ID()获取刚插入记录的自增主键值，在insert语句执行后，执行select LAST_INSERT_ID()就可以获取自增主键。
mysql:
``` 
    <insert id="insertUser" parameterType="cn.itcast.mybatis.po.User">
        <selectKey keyProperty="id" order="AFTER" resultType="int">
            select LAST_INSERT_ID()
        </selectKey>
        INSERT INTO USER(username,birthday,sex,address) VALUES(#{username},#{birthday},#{sex},#{address})
    </insert>
```
oracle:
实现思路：
先查询序列得到主键，将主键设置到user对象中，将user对象插入数据库。
``` 
    <!-- oracle
    在执行insert之前执行select 序列.nextval() from dual取出序列最大值，将值设置到user对象 的id属性
     -->
    <insert id="insertUser" parameterType="cn.itcast.mybatis.po.User">
        <selectKey keyProperty="id" order="BEFORE" resultType="int">
            select 序列.nextval() from dual
        </selectKey>
        
        INSERT INTO USER(id,username,birthday,sex,address) VALUES( 序列.nextval(),#{username},#{birthday},#{sex},#{address})
    </insert> 
```

